<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Dashboard</title>
<style>
body { background-color: #121212; color: #ffffff; font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin:0;}
h1 { color: #00ffcc; text-align:center; margin-bottom:20px; }
input, button { padding: 10px; margin: 5px 0; border-radius: 5px; border: none; font-size: 16px; }
input { width: 250px; }
button { cursor: pointer; background-color: #00ffcc; color: #121212; font-weight: bold; transition: 0.2s; }
button:hover { background-color: #00ddb0; }
pre { background: #1e1e1e; padding: 10px; border-radius: 5px; overflow-x: auto; width: 90%; max-width: 400px; }
.section { margin-top: 20px; border: 1px solid #00ffcc; border-radius: 10px; padding: 15px; width: 90%; max-width: 400px; }
</style>
</head>
<body>
<h1>Wallet Dashboard</h1>

<div class="section">
<h2>Wallet Info</h2>
<pre id="walletInfo"></pre>
</div>

<div class="section">
<h2>Transfer Funds</h2>
<input type="text" id="transferTo" placeholder="Recipient Address">
<input type="number" id="transferAmount" placeholder="Amount">
<button onclick="transferWallet()">Transfer</button>
<pre id="transferResult"></pre>
</div>

<script>
const API_BASE = 'https://wallet-system.r8sansoltani.workers.dev';
let email = localStorage.getItem('email');
let password = localStorage.getItem('password');
let address = localStorage.getItem('address');

if(!email || !password || !address){
    alert('Please login first');
    window.location.href = 'index.html';
}

async function loadWallet(){
    try{
        const res = await fetch(`${API_BASE}/login`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if(data.address){
            document.getElementById('walletInfo').textContent = JSON.stringify({
                address: data.address,
                balance: data.balance
            }, null, 2);
        } else {
            document.getElementById('walletInfo').textContent = 'Error fetching wallet info';
        }
    } catch(e){
        document.getElementById('walletInfo').textContent = 'Error fetching wallet info';
        console.error(e);
    }
}

async function transferWallet(){
    const to = document.getElementById('transferTo').value.trim();
    const amount = parseInt(document.getElementById('transferAmount').value);
    if(!to || !amount) return alert('Enter recipient and amount');

    try{
        const res = await fetch(`${API_BASE}/transfer`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ from: address, password, to, amount })
        });
        const data = await res.json();
        document.getElementById('transferResult').textContent = JSON.stringify(data,null,2);
        loadWallet(); // Update balance
    } catch(e){
        alert('Error transferring funds');
        console.error(e);
    }
}

loadWallet();
</script>
</body>
</html>
